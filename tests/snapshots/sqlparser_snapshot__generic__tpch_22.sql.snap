---
source: tests/sqlparser_snapshot.rs
expression: stmts
---
- Query:
    with: ~
    body:
      Select:
        distinct: ~
        top: ~
        projection:
          - UnnamedExpr:
              Identifier:
                value: cntrycode
                quote_style: ~
          - ExprWithAlias:
              expr:
                Function:
                  name:
                    - value: count
                      quote_style: ~
                  args:
                    - Unnamed: Wildcard
                  filter: ~
                  null_treatment: ~
                  over: ~
                  distinct: false
                  special: false
                  order_by: []
              alias:
                value: numcust
                quote_style: ~
          - ExprWithAlias:
              expr:
                Function:
                  name:
                    - value: sum
                      quote_style: ~
                  args:
                    - Unnamed:
                        Expr:
                          Identifier:
                            value: c_acctbal
                            quote_style: ~
                  filter: ~
                  null_treatment: ~
                  over: ~
                  distinct: false
                  special: false
                  order_by: []
              alias:
                value: totacctbal
                quote_style: ~
        into: ~
        from:
          - relation:
              Derived:
                lateral: false
                subquery:
                  with: ~
                  body:
                    Select:
                      distinct: ~
                      top: ~
                      projection:
                        - ExprWithAlias:
                            expr:
                              Substring:
                                expr:
                                  Identifier:
                                    value: c_phone
                                    quote_style: ~
                                substring_from:
                                  Value:
                                    Number:
                                      - "1"
                                      - false
                                substring_for:
                                  Value:
                                    Number:
                                      - "2"
                                      - false
                                special: false
                            alias:
                              value: cntrycode
                              quote_style: ~
                        - UnnamedExpr:
                            Identifier:
                              value: c_acctbal
                              quote_style: ~
                      into: ~
                      from:
                        - relation:
                            Table:
                              name:
                                - value: customer
                                  quote_style: ~
                              alias: ~
                              args: ~
                              with_hints: []
                              version: ~
                              partitions: []
                          joins: []
                      lateral_views: []
                      selection:
                        BinaryOp:
                          left:
                            BinaryOp:
                              left:
                                InList:
                                  expr:
                                    Substring:
                                      expr:
                                        Identifier:
                                          value: c_phone
                                          quote_style: ~
                                      substring_from:
                                        Value:
                                          Number:
                                            - "1"
                                            - false
                                      substring_for:
                                        Value:
                                          Number:
                                            - "2"
                                            - false
                                      special: false
                                  list:
                                    - Value:
                                        SingleQuotedString: "13"
                                    - Value:
                                        SingleQuotedString: "31"
                                    - Value:
                                        SingleQuotedString: "23"
                                    - Value:
                                        SingleQuotedString: "29"
                                    - Value:
                                        SingleQuotedString: "30"
                                    - Value:
                                        SingleQuotedString: "18"
                                    - Value:
                                        SingleQuotedString: "17"
                                  negated: false
                              op: And
                              right:
                                BinaryOp:
                                  left:
                                    Identifier:
                                      value: c_acctbal
                                      quote_style: ~
                                  op: Gt
                                  right:
                                    Subquery:
                                      with: ~
                                      body:
                                        Select:
                                          distinct: ~
                                          top: ~
                                          projection:
                                            - UnnamedExpr:
                                                Function:
                                                  name:
                                                    - value: avg
                                                      quote_style: ~
                                                  args:
                                                    - Unnamed:
                                                        Expr:
                                                          Identifier:
                                                            value: c_acctbal
                                                            quote_style: ~
                                                  filter: ~
                                                  null_treatment: ~
                                                  over: ~
                                                  distinct: false
                                                  special: false
                                                  order_by: []
                                          into: ~
                                          from:
                                            - relation:
                                                Table:
                                                  name:
                                                    - value: customer
                                                      quote_style: ~
                                                  alias: ~
                                                  args: ~
                                                  with_hints: []
                                                  version: ~
                                                  partitions: []
                                              joins: []
                                          lateral_views: []
                                          selection:
                                            BinaryOp:
                                              left:
                                                BinaryOp:
                                                  left:
                                                    Identifier:
                                                      value: c_acctbal
                                                      quote_style: ~
                                                  op: Gt
                                                  right:
                                                    Value:
                                                      Number:
                                                        - "0.00"
                                                        - false
                                              op: And
                                              right:
                                                InList:
                                                  expr:
                                                    Substring:
                                                      expr:
                                                        Identifier:
                                                          value: c_phone
                                                          quote_style: ~
                                                      substring_from:
                                                        Value:
                                                          Number:
                                                            - "1"
                                                            - false
                                                      substring_for:
                                                        Value:
                                                          Number:
                                                            - "2"
                                                            - false
                                                      special: false
                                                  list:
                                                    - Value:
                                                        SingleQuotedString: "13"
                                                    - Value:
                                                        SingleQuotedString: "31"
                                                    - Value:
                                                        SingleQuotedString: "23"
                                                    - Value:
                                                        SingleQuotedString: "29"
                                                    - Value:
                                                        SingleQuotedString: "30"
                                                    - Value:
                                                        SingleQuotedString: "18"
                                                    - Value:
                                                        SingleQuotedString: "17"
                                                  negated: false
                                          group_by:
                                            Expressions: []
                                          cluster_by: []
                                          distribute_by: []
                                          sort_by: []
                                          having: ~
                                          named_window: []
                                          qualify: ~
                                      order_by: []
                                      limit: ~
                                      limit_by: []
                                      offset: ~
                                      fetch: ~
                                      locks: []
                          op: And
                          right:
                            Exists:
                              subquery:
                                with: ~
                                body:
                                  Select:
                                    distinct: ~
                                    top: ~
                                    projection:
                                      - Wildcard:
                                          opt_exclude: ~
                                          opt_except: ~
                                          opt_rename: ~
                                          opt_replace: ~
                                    into: ~
                                    from:
                                      - relation:
                                          Table:
                                            name:
                                              - value: orders
                                                quote_style: ~
                                            alias: ~
                                            args: ~
                                            with_hints: []
                                            version: ~
                                            partitions: []
                                        joins: []
                                    lateral_views: []
                                    selection:
                                      BinaryOp:
                                        left:
                                          Identifier:
                                            value: o_custkey
                                            quote_style: ~
                                        op: Eq
                                        right:
                                          Identifier:
                                            value: c_custkey
                                            quote_style: ~
                                    group_by:
                                      Expressions: []
                                    cluster_by: []
                                    distribute_by: []
                                    sort_by: []
                                    having: ~
                                    named_window: []
                                    qualify: ~
                                order_by: []
                                limit: ~
                                limit_by: []
                                offset: ~
                                fetch: ~
                                locks: []
                              negated: true
                      group_by:
                        Expressions: []
                      cluster_by: []
                      distribute_by: []
                      sort_by: []
                      having: ~
                      named_window: []
                      qualify: ~
                  order_by: []
                  limit: ~
                  limit_by: []
                  offset: ~
                  fetch: ~
                  locks: []
                alias:
                  name:
                    value: custsale
                    quote_style: ~
                  columns: []
            joins: []
        lateral_views: []
        selection: ~
        group_by:
          Expressions:
            - Identifier:
                value: cntrycode
                quote_style: ~
        cluster_by: []
        distribute_by: []
        sort_by: []
        having: ~
        named_window: []
        qualify: ~
    order_by:
      - expr:
          Identifier:
            value: cntrycode
            quote_style: ~
        asc: ~
        nulls_first: ~
    limit: ~
    limit_by: []
    offset: ~
    fetch: ~
    locks: []

